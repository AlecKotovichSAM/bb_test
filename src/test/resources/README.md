# Интеграционные тесты

## Конфигурация

Тесты используют in-memory H2 базу данных для изоляции и скорости выполнения.

### Файл конфигурации: `application-test.properties`

- **База данных**: `jdbc:h2:mem:testdb` (in-memory)
- **DDL режим**: `validate` (Hibernate проверяет схему, созданную Flyway)
- **Flyway**: включен (миграции выполняются перед тестами)
- **Логирование**: минимальное (только INFO и выше)

**Важно**: Flyway создает схему базы данных из миграций перед запуском тестов, что делает тесты более реалистичными и проверяет корректность миграций.

## Запуск тестов

```bash
# Все тесты
mvn test

# Конкретный тестовый класс
mvn test -Dtest=UsersControllerIntegrationTest

# Конкретный тест
mvn test -Dtest=UsersControllerIntegrationTest#testCreateUser_WithIdZero_ShouldFixAndCreate
```

## Структура тестов

### UsersControllerIntegrationTest
- ✅ Создание пользователя без ID
- ✅ **Создание пользователя с id=0 (фикс бага)**
- ✅ Получение всех пользователей
- ✅ Получение пользователя по ID
- ✅ Обновление пользователя
- ✅ Удаление пользователя
- ✅ Создание нескольких пользователей с id=0

### EventsControllerIntegrationTest
- ✅ Создание события с id=0 (фикс бага)
- ✅ Создание события без ID
- ✅ Получение всех событий
- ✅ Получение событий пользователя
- ✅ Отмена события
- ✅ Удаление события

### GiftsControllerIntegrationTest
- ✅ Создание подарка с id=0 (фикс бага)
- ✅ Создание подарка без ID
- ✅ Резервация подарка
- ✅ Отмена резервации
- ✅ Получение подарков события
- ✅ Удаление подарка

## Особенности

1. **Изоляция тестов**: Каждый тест использует `@Transactional` и `@BeforeEach` для очистки данных
2. **In-memory база**: Быстрое выполнение без необходимости внешней БД
3. **Проверка фикса бага**: Специальные тесты для проверки исправления проблемы с `id=0`
4. **Полная интеграция**: Тесты проверяют весь стек (Controller → Service → Repository → Database)
